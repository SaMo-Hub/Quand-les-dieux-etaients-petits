<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Audio Player</title>
</head>
<body>
  <script>
    // Lecteur audio global qui persiste
    const audio = new Audio('./public/music/NujabesLuv.mp3');
    audio.loop = true;
    audio.volume = 0.5;

    // Sauvegarder l'état régulièrement
    setInterval(() => {
      if (!audio.paused) {
        localStorage.setItem('musicTime', audio.currentTime);
        localStorage.setItem('musicPlaying', 'true');
      }
    }, 200);

    // Exposer des fonctions pour contrôler l'audio
    window.playAudio = function() {
      const savedTime = parseFloat(localStorage.getItem('musicTime')) || 0;
      if (audio.paused && savedTime > 0) {
        audio.currentTime = savedTime;
      }
      return audio.play().then(() => {
        localStorage.setItem('musicPlaying', 'true');
      });
    };

    window.pauseAudio = function() {
      audio.pause();
      localStorage.setItem('musicPlaying', 'false');
      localStorage.setItem('musicTime', audio.currentTime);
    };

    window.isPlaying = function() {
      return !audio.paused;
    };

    window.toggleAudio = function() {
      if (audio.paused) {
        return window.playAudio();
      } else {
        window.pauseAudio();
        return Promise.resolve();
      }
    };

    // Reprendre automatiquement si c'était en cours
    window.addEventListener('load', () => {
      const wasPlaying = localStorage.getItem('musicPlaying') === 'true';
      const hasInteracted = localStorage.getItem('hasInteracted') === 'true';
      
      if (wasPlaying && hasInteracted) {
        setTimeout(() => {
          window.playAudio();
        }, 100);
      }
    });
  </script>
</body>
</html>